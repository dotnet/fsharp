<Project>
  <PropertyGroup>
    <LoadLocalFSharpBuild Condition="'$(LoadLocalFSharpBuild)' == ''">False</LoadLocalFSharpBuild>
    
    <LocalFSharpCompilerConfiguration Condition="'$(LocalFSharpCompilerConfiguration)' == ''">Release</LocalFSharpCompilerConfiguration>

    <LocalFSharpCompilerPath Condition=" '$(LocalFSharpCompilerPath)' == '' ">$(MSBuildThisFileDirectory)</LocalFSharpCompilerPath>

    <!-- Define FSharpNetCoreProductDefaultTargetFramework by reading from productTfm.txt.
         For regression tests: productTfm.txt is co-located with this props file.
         For local usage: use eng/productTfm.txt relative to this file's directory. -->
    <_UseLocalCompilerProductTfmPath Condition="Exists('$(MSBuildThisFileDirectory)productTfm.txt')">$(MSBuildThisFileDirectory)productTfm.txt</_UseLocalCompilerProductTfmPath>
    <_UseLocalCompilerProductTfmPath Condition="'$(_UseLocalCompilerProductTfmPath)' == ''">$(MSBuildThisFileDirectory)eng/productTfm.txt</_UseLocalCompilerProductTfmPath>
    <FSharpNetCoreProductDefaultTargetFramework Condition="'$(FSharpNetCoreProductDefaultTargetFramework)' == ''">$([System.IO.File]::ReadAllText('$(_UseLocalCompilerProductTfmPath)').Trim())</FSharpNetCoreProductDefaultTargetFramework>

    <DisableImplicitFSharpCoreReference>true</DisableImplicitFSharpCoreReference>
    <DisableAutoSetFscCompilerPath>true</DisableAutoSetFscCompilerPath>
    <FscToolPath Condition="'$(FscToolPath)' == ''">$([System.IO.Path]::GetDirectoryName($(DOTNET_HOST_PATH)))</FscToolPath>
    <FscToolExe Condition="'$(FscToolExe)' == ''">$([System.IO.Path]::GetFileName($(DOTNET_HOST_PATH)))</FscToolExe>

    <DotnetFscCompilerPath>$(LocalFSharpCompilerPath)/artifacts/bin/fsc/$(LocalFSharpCompilerConfiguration)/$(FSharpNetCoreProductDefaultTargetFramework)/fsc.dll</DotnetFscCompilerPath>
    <Fsc_DotNET_DotnetFscCompilerPath>$(LocalFSharpCompilerPath)/artifacts/bin/fsc/$(LocalFSharpCompilerConfiguration)/$(FSharpNetCoreProductDefaultTargetFramework)/fsc.dll</Fsc_DotNET_DotnetFscCompilerPath>

    <FSharpPreferNetFrameworkTools>False</FSharpPreferNetFrameworkTools>
    <FSharpPrefer64BitTools>True</FSharpPrefer64BitTools>
  </PropertyGroup>

  <!-- 
    Use FSharpTargetsShim to redirect the SDK to use the locally built F# targets.
    This replaces all the individual UsingTask overrides since Microsoft.FSharp.NetSdk.targets
    imports Microsoft.FSharp.Targets which registers all the F# build tasks.
    See: https://github.com/dotnet/sdk/blob/main/src/Tasks/Microsoft.NET.Build.Tasks/targets/Microsoft.NET.Sdk.FSharpTargetsShim.targets
  -->
  <PropertyGroup Condition="'$(LoadLocalFSharpBuild)' == 'True'">
    <LocalFSharpBuildBinPath>$(LocalFSharpCompilerPath)/artifacts/bin/fsc/$(LocalFSharpCompilerConfiguration)/$(FSharpNetCoreProductDefaultTargetFramework)</LocalFSharpBuildBinPath>
    <FSharpBuildAssemblyFile>$(LocalFSharpBuildBinPath)/FSharp.Build.dll</FSharpBuildAssemblyFile>
    <FSharpTargetsPath>$(LocalFSharpBuildBinPath)/Microsoft.FSharp.Targets</FSharpTargetsPath>
    <FSharpPropsShim>$(LocalFSharpBuildBinPath)/Microsoft.FSharp.NetSdk.props</FSharpPropsShim>
    <FSharpTargetsShim>$(LocalFSharpBuildBinPath)/Microsoft.FSharp.NetSdk.targets</FSharpTargetsShim>
    <FSharpOverridesTargetsShim>$(LocalFSharpBuildBinPath)/Microsoft.FSharp.Overrides.NetSdk.targets</FSharpOverridesTargetsShim>
  </PropertyGroup>

  <ItemGroup>
    <Reference Include="$(LocalFSharpCompilerPath)/artifacts/bin/FSharp.Core/$(LocalFSharpCompilerConfiguration)/netstandard2.0/FSharp.Core.dll" />
  </ItemGroup>
</Project>
