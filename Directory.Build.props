<Project>

  <!-- Import target frameworks from single source of truth -->
  <Import Project="$(MSBuildThisFileDirectory)eng/TargetFrameworks.props" />

  <PropertyGroup>
    <PackageProjectUrl>https://github.com/dotnet/fsharp</PackageProjectUrl>
    <RepositoryUrl>https://github.com/dotnet/fsharp</RepositoryUrl>
    <LangVersion Condition="'$(FSharpLangVersion)' != ''">$(FSharpLangVersion)</LangVersion>
    <RepoRoot Condition="'$(RepoRoot)' == ''">$(MSBuildThisFileDirectory)</RepoRoot>
    <AccelerateBuildsInVisualStudio>true</AccelerateBuildsInVisualStudio>
    <IgnoreMibc Condition="'$(IgnoreMibc)' == ''">$(DotNetBuildSourceOnly)</IgnoreMibc>
    <!-- When building the .NET product, there's no need to publish Windows PDBs. Any conversion to Windows PDBs will be done during staging, if necessary. -->
    <PublishWindowsPdb Condition="'$(DotNetBuild)' == 'true'">false</PublishWindowsPdb>
  </PropertyGroup>

  <!--
   When developers load the FSharp.Compiler.Service solution we set FSHARPCORE_USE_PACKAGE to true if it hasn't already been set to a value.
   This option ensures that building and testing uses the specified FSharp.Core nuget package instead of the local FSharp.Core project.
   We also disable arcade and reset certain artifacts and compiler paths to use default ones.
   All settings below can be overridden via CLI switches if needed. -->

  <PropertyGroup Condition="'$(SolutionName)' == 'FSharp.Compiler.Service' and '$(BUILDING_USING_DOTNET)' != 'false'">
      <BUILDING_USING_DOTNET>true</BUILDING_USING_DOTNET>
  </PropertyGroup>

  <PropertyGroup Condition="'$(SolutionName)' == 'FSharp.Benchmarks' and '$(BUILDING_USING_DOTNET)' != 'false'">
      <BUILDING_USING_DOTNET>true</BUILDING_USING_DOTNET>
  </PropertyGroup>

  <!-- Temporary workaround if proj-info is used, allows Ionide's evaluation to work correctly. -->
  <PropertyGroup Condition="'$(BUILDING_USING_DOTNET)' != 'false' and '$(DotnetProjInfo)' == 'true'">
      <BUILDING_USING_DOTNET>true</BUILDING_USING_DOTNET>
  </PropertyGroup>

  <!-- pick realsig value -->
  <PropertyGroup Condition="'$(BUILDING_USING_DOTNET)' != 'true' and '$(Configuration)' != 'Proto'">
    <OtherFlags Condition="'$(BuildNoRealsig)' == 'true'">$(OtherFlags) --realsig-</OtherFlags>
    <OtherFlags Condition="'$(BuildNoRealsig)' != 'true'">$(OtherFlags) --realsig+</OtherFlags>
  </PropertyGroup>

  <PropertyGroup>
    <!-- Set PublishReadyToRun to speed up the build. -->
    <EnablePublishReadyToRun>true</EnablePublishReadyToRun>
    <!-- Crossgen2 is not built with source-built Mono-based .NET SDKs. -->
    <EnablePublishReadyToRun Condition="'$(DotNetBuildUseMonoRuntime)' == 'true'">false</EnablePublishReadyToRun>
  </PropertyGroup>

  <Import Project="$(RepoRoot)/Directory.Build.props.user" Condition="Exists('$(RepoRoot)/Directory.Build.props.user')" />

  <PropertyGroup Condition="'$(BUILDING_USING_DOTNET)' == 'true'">
    <DisableAutoSetFscCompilerPath>false</DisableAutoSetFscCompilerPath>

    <FSHARPCORE_USE_PACKAGE Condition="'$(FSHARPCORE_USE_PACKAGE)' == ''">true</FSHARPCORE_USE_PACKAGE>

    <DISABLE_ARCADE Condition="'$(DISABLE_ARCADE)' == ''">true</DISABLE_ARCADE>
    <ArtifactsDir>$(MSBuildThisFileDirectory)artifacts/</ArtifactsDir>
    <OutputPath>$(ArtifactsDir)/bin/$(MSBuildProjectName)/$(Configuration)/</OutputPath>
    <IntermediateOutputPath>$(ArtifactsDir)obj/$(MSBuildProjectName)/$(Configuration)/</IntermediateOutputPath>
    <!-- Note, that default framework is used here (the one we use for development in the current cycle),
         since it's a non-arcade and non-sourcebuild scenario -->
    <FsLexPath>$(ArtifactsDir)/bin/fslex/$(Configuration)/$(FSharpNetCoreProductTargetFramework)/$(RuntimeIdentifier)/fslex.dll</FsLexPath>
    <FsYaccPath>$(ArtifactsDir)/bin/fsyacc/$(Configuration)/$(FSharpNetCoreProductTargetFramework)/$(RuntimeIdentifier)/fsyacc.dll</FsYaccPath>
    <DefineConstants>BUILDING_WITH_LKG;$(DefineConstants)</DefineConstants>
  </PropertyGroup>

  <Import Project="$(MSBuildThisFileDirectory)/eng/Versions.props" Condition="'$(DISABLE_ARCADE)' == 'true'" />

  <Import Project="FSharpBuild.Directory.Build.props" Condition=" '$(FSharpTestCompilerVersion)' == '' " />

  <!-- Source-build override: Arcade SDK (imported above) provides $(NetCurrent).
       Cannot live in eng/TargetFrameworks.props because it's imported before Arcade. -->
  <PropertyGroup Condition="'$(DotNetBuildSourceOnly)' == 'true'">
    <FSharpNetCoreProductTargetFramework>$(NetCurrent)</FSharpNetCoreProductTargetFramework>
  </PropertyGroup>

  <!-- It's important we set TFM before this, since FSharpTests.Directory.Build.props uses it.
       TODO(vlza): this build props looks outdated, since we only use $(FSharpTestCompilerVersion) in TP tests or cambridge suite (which we slowly want to migrate to xUnit).
                   We probably should remove or revisit it. -->
  <Import Project="FSharpTests.Directory.Build.props" Condition=" '$(FSharpTestCompilerVersion)' != '' " />

  <ItemGroup>
    <!-- If there is a README.md next to a project file, include it (for easier access in the IDE) -->
    <None Include="README.md" Condition="Exists('README.md')" />
  </ItemGroup>

</Project>
